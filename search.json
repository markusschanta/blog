[
  {
    "objectID": "posts/2022-world-cup-start/index.html",
    "href": "posts/2022-world-cup-start/index.html",
    "title": "Who Will Win the World Cup? A Quantitative Approach.",
    "section": "",
    "text": "This year’s world cup seems a bit like the dish that nobody ordered. Inconvenient ethical questions aside, the world cup is traditionally one of the events around which the highest volume of sports betting is transacted. To put things into perspective, on the seemingly bland question “Will Ecuador reach the Quarter Final?”, more than 5,084 Euros have been wagered on one online betting platform alone. For all of the games of the FIFA World Cup, more than 10 million euros worth of bets have been placed on the same platform. As a data scientist, it’s exciting to observe how all of that punting, in aggregate, produces a quite comprehensive collective valuation of the chances of success for each of the teams.\nThe big question is of course: “Who will win the World Cup?” Crunching the numbers, one can work out the implicit probabilities in the odds offered for each team. As of 9 am today, the odds were as follows:\n\n\nCode\nimport altair as alt\nimport pandas as pd\n\nSTAGE_ORDER = ['win', 'final', 'semi', 'quarter', 'qualify']\nSTAGE_ORDER_MAP = {v: k for k, v in enumerate(STAGE_ORDER[::-1])}\n\nSTAGE_NAME_MAP = {\n    \"win\": \"Win the Tournament\",\n    \"final\": \"Reach the Finals\",\n    \"semi\": \"Reach the Semi-Finals\",\n    \"quarter\": \"Reach the Quarter-Finals\",\n    \"qualify\": \"Reach the Round of 16\"\n}\n\nlast = pd.read_csv('teams.20221120.csv')\n\nchart = last.copy().loc[:, ['country', 'p', 'stage']]\nchart['stage_order'] = chart.stage.apply(lambda b: STAGE_ORDER_MAP[b])\nchart['stage_nice'] = chart.stage.apply(lambda b: STAGE_NAME_MAP[b])\nchart['y'] = 0\nchart = chart.sort_values('stage_order')\n\ncountry_order = list(chart[chart.stage == 'win'].sort_values('p', ascending=False)['country'])\n\nalt.Chart(chart[chart.stage == 'win']).mark_bar(size=12).encode(\n    x=alt.X('country:O', axis=alt.Axis(title=\"\"), sort=country_order),\n    y=alt.Y('p:Q', axis=alt.Axis(title=\"Probability\", format=\"%\")),\n    y2='y',\n    color=alt.Color(\n        field='stage_nice', type='ordinal', sort=[STAGE_NAME_MAP[b] for b in STAGE_ORDER][::-1],\n        legend=None, scale=alt.Scale(scheme='greens')\n    ),\n    tooltip = [\n        alt.Tooltip('country', title=\"Country\"), \n        alt.Tooltip('p', title=\"Probability to Win\", format=\".2%\")\n    ]\n).properties(\n    width={\"step\": 16}\n)\n\n\n\n\n\n\n\nTo work out how these odds are derived, consider the following: As of today, bookmakers are offering to bet on Brazil winning the tournament with a payout of 4.4 times the wager. To bet against Brazil winning the tournament is offered at odds of 4.5. To come up with a probability, we first take the midpoint of those two numbers, which is 4.45. We then invert that number and we get an implied probability of precisely 22.4719% for Brazil to win the World Cup.\nAs mentioned, there are a lot more events that people can and do bet on. From those, it is possible to determine the odds of any team reaching the round of 16, quarter-finals, semi-finals and finals. All of these odds for each team are shown in the chart below:\n\n\nCode\nalt.Chart(chart).mark_bar(size=12).encode(\n    x=alt.X('country:O', axis=alt.Axis(title=\"\"), sort=country_order),\n    y=alt.Y('p:Q', axis=alt.Axis(title=\"Probability\", format=\"%\")),\n    y2='y',\n    color=alt.Color(\n        field='stage_nice', type='ordinal', sort=[STAGE_NAME_MAP[b] for b in STAGE_ORDER][::-1],\n        legend=alt.Legend(title=\"Position\"), scale=alt.Scale(scheme='greens')\n    ),\n    tooltip = [\n        alt.Tooltip('country', title=\"Country\"),\n        alt.Tooltip('stage_nice', title=\"Position\"),\n        alt.Tooltip('p', title=\"Probability\", format=\".2%\")\n    ]\n).properties(\n    width={\"step\": 16}\n)\n\n\n\n\n\n\n\nOne thing that stands out here is that the probability ratios between these outcomes are not exactly the same for each team. Take Serbia and Ecuador for example: Serbia has a 1.0% implied chance of winning the tournament, while Ecuador has a 0.4% chance. Despite the better odds to win the tournament, Serbia has a 47.4% chance of qualifying for the round of 16, while Ecuador has a 46.9% chance. This is because Serbia is in a particularly strong group, while Ecuador is in a relatively weak group. Below are the cumulative probabilities of winning the tournament per each group:\n\n\nCode\ngroups = last[last.stage == 'qualify'].rename(columns = {'bet': 'group'})[['country', 'group']]\ngroups = last.merge(groups, left_on='country', right_on='country')\n\nwin = groups[groups.bet == 'win']\nby_group_chart = win.groupby('group').sum().reset_index()\n\ny = by_group_chart.sort_values('p', ascending=False).reset_index(drop='true').reset_index().loc[:, ['group', 'index']]\ny.columns = ['group', 'y']\n\nx = win.groupby('group').apply(lambda x: x.reset_index().reset_index()[['country', 'level_0']]).reset_index(drop=True)\nx.columns = ['country', 'x']\n\nsquare = win.merge(x, left_on='country', right_on='country')\nsquare = square.merge(y, left_on='group', right_on='group')\n\nlabels = alt.Chart(square).mark_text(baseline=\"middle\").encode(\n    x=alt.X('x:O', axis=alt.Axis(title='', ticks=False, labels=False, grid=False, domain=False)),\n    y=alt.Y('y:O', axis=alt.Axis(title='', ticks=False, labels=False, grid=False, domain=False)),\n    text='country',\n).properties(\n    width=250,\n    height=200\n)\n\nbars = by_group_chart.copy()\nbars.group = bars.group.apply(lambda s: \"Group \" + s.upper())\n\nbars = alt.Chart(bars).mark_bar().encode(\n    x=alt.X('p:Q', axis=alt.Axis(title=\"Combined Probability to Win\", format=\"%\")),\n    y=alt.Y('group:N', axis=alt.Axis(title=\"\",), sort='-x'),\n    color=alt.Color(field='foo', legend=None, scale=alt.Scale(scheme='greens')),\n    tooltip = [\n        alt.Tooltip('group', title=\"Group\"), \n        alt.Tooltip('p', title=\"Combined Probability to Win\", format=\".2%\")\n    ]\n).properties(\n    width=400,\n    height=200\n)\n\n(labels | bars).configure_axisY(\n    labelFontSize=11\n).configure_view(\n    stroke = \"white\"\n)\n\n\n\n\n\n\n\nOne final thing one might wonder about is who’s going to emerge as the tournament’s top goal scorer. On this one, Tottenham striker Harry Kane seems to be the consensus favourite after already winning the Golden Boot at the 2018 FIFA World Cup, followed by Kylian Mbappe and Lionel Messi:\n\n\nCode\ngoalscorer = pd.read_csv('goalscorer.20221120.csv').sort_values('p', ascending=False)\n\nalt.Chart(goalscorer.iloc[:40]).mark_bar(size=12).encode(\n    x=alt.X('country:O', axis=alt.Axis(title=\"Player\"), sort='-y'),\n    y=alt.Y('p:Q', axis=alt.Axis(title=\"Probability\", format=\"%\")),\n    # y2='y',\n    color=alt.Color(\n        field='stage_nice', type='ordinal', sort=[STAGE_NAME_MAP[b] for b in STAGE_ORDER][::-1],\n        legend=None, scale=alt.Scale(scheme='greens')\n    ),\n    tooltip = [\n        alt.Tooltip('country', title=\"Player\"), \n        alt.Tooltip('p', title=\"Probability\", format=\".2%\")\n    ]\n).properties(\n    width={\"step\": 16}\n)\n\n\n\n\n\n\n\nThe World Cup kicks off tomorrow with the classic crowd-pleaser Qatar v Ecuador. We will see whether the host nation will be able to turn the 9.8% odds of winning in their favour. Maybe instead the Ecuadorians can capitalise on their 68.3% implied probability of winning the game or at least achieve the draw that has a 21.9% probability. Time will tell! Until then you can follow this blog for more quantitative analysis of the World Cup and updates about how these probabilities shift as the events unfold."
  },
  {
    "objectID": "posts/post-with-code/index.html",
    "href": "posts/post-with-code/index.html",
    "title": "Post With Code",
    "section": "",
    "text": "This is a post with executable code."
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "blog",
    "section": "",
    "text": "Post With Code\n\n\n\n\n\n\n\nnews\n\n\ncode\n\n\nanalysis\n\n\n\n\n\n\n\n\n\n\n\nNov 21, 2022\n\n\nHarlow Malloc\n\n\n\n\n\n\n  \n\n\n\n\nWho Will Win the World Cup? A Quantitative Approach.\n\n\n\n\n\n\n\npython\n\n\naltair\n\n\nvisualisation\n\n\nfootball\n\n\n\n\n2022 FIFA World Cup betting odds and what they tell us about each team’s likelyhood to succeed.\n\n\n\n\n\n\nNov 19, 2022\n\n\n\n\n\n\n  \n\n\n\n\nWelcome To My Blog\n\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\n\n\nNov 18, 2022\n\n\nTristan O’Malley\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this blog"
  }
]